# 事务
什么是事务：并发控制的基本单元，包括一系列数据库操作，需满足ACID特性 

## ACID
#### Atomicity 原子性
对数据库的一系列操作要么都执行要么都不执行
#### Consistency 一致性
事务执行前后数据库的信息要保持一致
#### Isolation 隔离性
两个事务的执行互不影响
#### Duration 持续性
事务执行后对数据库的改变是持久的

## 事务并发过程中可能产生的问题
#### 脏读
读取另一事务未提交的更新
#### 不可重复读
同一事务中两次读取相同的记录，结果不一致
#### 幻读
同一事务两次读取的结果包含的行记录数不一致

## 事务隔离级别

隔离级别                      |脏读|不可重复读 |幻读
---------------------------  |-----|---------|---
读取未提交（Read uncommitted）|可能  |可能     |可能
读取已提交（Read committed）  |不可能|可能     |可能
可重复读（Repeatable read）   |不可能|不可能   |可能
可串行化（Serializable ）     |不可能|不可能   |不可能

> 隔离级别越高，越能保持数据的完整性和一致性，但并发效果越差  

> Mysql支持四种隔离级别，默认隔离级别是Repeatable read

## 传播行为（Propagation）

传播行为（7种）|含义|备注
-------|----|---
REQUIRED|当方法调用时，如果不存在当前事务，就创建事务；如果之前的方法已经存在了事务，那么就沿用之前的事务|这是Spring默认的传播行为
REQUIRES_NEW|无论是否存在当前事务，方法都会在新的事务中运行|也就是事务管理器会打开新的事务运行该方法
NESTED|嵌套事务，也就是调用方法如果抛出异常只回滚自己内部执行的SQL，而不回滚主方法的SQL|它的实现存在两种情况，如果当前数据库支持保存点（savapoint），那么它就会在当前事务上使用保存点技术；如果发生异常则回滚到保存点，而不是全部回滚，否则就等同于REQUIRES_NEW创建新的事务运行方法代码
MANDATORY|方法必须在事务中运行|如果不存在当前事务，则抛出异常
NEVER|不支持事务，只有在没有事务的幻境中才能运行它|如果方法存在当前事务，则抛出异常
........|.........|.........
